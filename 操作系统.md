# 操作系统

# 第1章 计算机系统概述

### 1.1 操作系统的基本概念

#### 1.1.1 操作系统的概念(定义)

操作系统是系统资源的管理者(硬件和软件),组织调度计算机的工作和资源的分配；向上层提供方便易用的服务；是计算机最基本（最接近硬件）的系统软件。

#### 1.1.2 操作系统的特征

1. 并发：指两个或多个以上的事件在同一时间间隔内发生。宏观上同时发生，微观上是交替发生的。

   + 操作系统和程序并发一起诞生的；
   + 同一时刻发生是并行，同一时间段内发生是并发；
   + 单核CPU同一时刻只能执行一个程序，各个程序只能并发执行；
   + 多核CPU同一时刻可以执行多个程序，多个程序可以并行执行，执行的程序数量大于CPU核数量，则并发也存在。

2. 共享：资源共享，操作系统中的资源可供多个并发执行的进程同时使用。

   + 互斥共享方式：一个时间段内只允许一个进程访问，比如摄像头。
   + 同时共享方式：一个时间段内允许多个进程“同时”使用，比如同时微信发送A文件、QQ发送B文件，宏观上同时发送，微观上是交替访问磁盘。

3. 虚拟：把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者）是用户感受到的。

   + 时分复用技术：比如虚拟处理器；
   + 空分复用技术：比如虚拟存储器。

4. 异步：在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，

   而是走走停停，以不可预知的速度向前推进。

重要考点：

+ 并发是同一时间段内同时发生，并行是同一时刻同时发生；

+ 并发和共享互为存在条件；

+ 没有并发和共享，就谈不上虚拟和异步，因此并发和共享是操作系统的两个最基本的特征。

#### 1.1.3 操作系统的功能

1. 作为资源的管理者

   + 处理机管理：进程的管理
   + 文件管理
   + 存储器管理
   + 设备管理

2. 向上层提供的服务(接口)

   + GUI(图形用户界面)（用户直接使用）
   + 命令接口（用户直接使用）
     + 脱机命令接口(交互式命令接口)
     + 联机命令接口（批处理命令接口）

   + 程序接口:由一组系统调用（广义指令）组成。（程序员/软件使用）

     库函数和系统调用的区别：库函数运行在用户空间，系统调用运行在内核空间。

   


3. 实现对硬件机器的拓展

   没有任何软件支持的计算机成为**裸机**。在裸机上安装的操作系统，通常把覆盖了软件的机器成为**扩充机器**，又称之为**虚拟机**。

### 1.2 操作系统的发展和分类

#### 1.2.1 手工操作阶段

+ 缺点：用户独占全机、人机速度矛盾导致资源利用率极低

#### 1.2.2 批处理阶段

1. 单道批处理系统

   引入脱机输入/输出技术，并由监督程序负责控制作业的输入、输出。作业连续通过外围机写到磁带中，由磁带写入内容，经过处理机运算再输出到磁带中。

   + 优点：缓解了一定程度的人机速度矛盾

   + 缺点：内存中仅能有一道程序运行
   + 缺点：CPU有大量的时间是在空闲等待I/O完成

2. 多道批处理系统

   每次往内存中读入多道程序，操作系统正式诞生。

   + 优点：多道程序并发执行，共享计算机资源，系统吞吐量增大。
   + 缺点：没有人机交互功能。

#### 1.2.3 实时操作系统

**在严格的时限内处理完事件**。实时操作系统的主要特点是及时性和可靠性。

优点：能够优先响应一些紧急任务，某些紧急任务不需时间片排队。

+ 硬时操作系统：必须在绝对严格的规定时间内完成任务。(比如导弹系统，自动驾驶系统)
+ 软时操作系统：能接受偶尔违饭时间规定(比如12306火车订票系统)



#### 1.2.4 其他操作系统

1. 网络操作系统：实现资源共享，以及各个计算机之间的交流。

2. 分布式操作系统：主要特点是分布性和并行性。系统中的各台计算机地位相同，任何工作都可以分布在这些

   计算机上，由它们并行、协同完成这个任务。

3. 个人计算机操作系统



### 1.3 操作系统的运行环境

#### 1.3.1	操作系统的运行机制(模式)

1. 程序运行的原理

   一条高级语言的代码通过编译器可能被"翻译"成多条指令：

   ```c
   int x = 1;
   x++;
   /**翻译**/
   
   00010100010100101
   00000101010100101
   00000100010100101
   00000100010110101
   
   ```

   程序运行的过程其实就是CPU执行一条一条指令的过程。

   + 指令：cpu能识别、执行的最基本的命令

2. 特权指令和非特权指令

   CPU在设计和生产的时候就划分了特权指令和非特权指令，所以cpu在执行一条指令前，就可以判断其类型。

   + 特权指令：如“内存清除指令”，只能内核程序使用。
   + 非特权指令：如“加法指令”、“减法指令”，普通应用程序使用。

3. 内核程序和应用程序

   + 内核程序：一组内核程序组成操作系统的内核(kernel，最接近硬件，操作系统可以只有内核)。可以执行特权指令
   + 应用程序：不能执行特权指令，如果强行执行，则会触发中断信号

   

4. 内核态和用户态

   CPU 有两种状态，“内核态”和“用户态”。

   + 内核态（核心态、管态）：处于内核态时，说明此时正在运行的是内核程序，此时可以执行特权指令
   + 用户态（目态）：处于用户态时，说明此时正在运行的是应用程序，此时只能执行非特权指令



内核态转为用户态：执行一条特权指令——修改PSW(程序状态字寄存器)的标志位为“用户态”，这个动作意味着操作系统内核将主动让出CPU使用权

用户态转为用户态：由“中断”引发，硬件自动完成变态过程，触发中断信号意味着操作系统内核将强行夺回CPU的使用权

除了非法使用特权指令之外，还有很多事件会触发中断信号。一个共性是，但凡需要操作系统介入的地方，都会触发中断信号。

#### 1.3.2	中断和异常

1. 什么是中断？

   “中断”会使CPU由用户态变为内核态，使操作系统重新夺回对CPU的控制权，“中断”是让操作系统内核夺回CPU使用权的唯一途径。

2. 内中断(异常、例外)

   与当前执行的指令有关，中断信号来源于CPU内部。CPU在**执行指令时**会检查是否有异常发生。有些内中断会重新将控制权还给应用程序继续执行指令，有些中断会直接终止应用程序运行。

   ![](https://github.com/2511366062/drawioPIC_lxk/blob/main/408os/408OS1.drawio.png?raw=true)

   + 陷阱、陷入：由陷入指令引发，是应用程序故意引发的
   + 故障：由错误条件引起的，可能被内核程序修复。内核程序修复故障后会把 CPU使用权还给应用程序，让它继续执行下去。如：缺页故障。
   + 终止：由致命错误引起，内核程序无法修复该错误，因此一般不再将CPU使用权还给引发终止的应用程序，而是直接终止该应用程序。如：整数除0、非法使用特权指令

3. 外中断(狭义上的中断)

   与当前执行的指令无关，中断信号来源于CPU外部。每个**指令周期末尾**时，CPU都会例行检查是否有外中断信号。

   + 时钟中断——由时钟部件发来的中断信号：

     时钟部件每隔一个时间片（如 50ms）会给CPU发送一个时钟中断信号

   + I/O中断请求

     当输入输出任务完成时，向CPU发送中断信号

4. 中断机制的基本原理

   当CPU收到中断信号后，不同的中断信号，需要用不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号的类型去查询“中断向量表”，以此来找到相应的中断处理程序在内存中的存放位置。

   ![](https://github.com/2511366062/drawioPIC_lxk/blob/main/408os/3ad28ca22dbce31dc93bb19dd60c9ca.png?raw=true)

#### 1.3.4 系统调用

1. 什么是系统调用？

   “系统调用”是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以**通过系统调用来请求获得操作系统内核的服务**。

2. **系统调用与库函数的区别**？

   普通应用程序可直接进行系统调用，也可使用库函数。有的库函数涉及系统调用，有的不涉及，系统调用更底层。系统调用处理程序运行在内核态，库函数运行在用户态。

3. **为什么系统调用是必须的？**

   由操作系统内核对共享资源进行统一的管理，并向上提供“系统调用” ，用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统内核发出请求。内核会对各个请求进行协调处理。

4. **什么功能要用到系统调用？**

   凡是与共享资源有关的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提出服务请求，由操作系统内核代为完成。这样可以保证系统的稳定性和安全性。

   ![](https://github.com/2511366062/drawioPIC_lxk/blob/main/408os/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%88%86%E7%B1%BB.png?raw=true)

   



5. **系统调用的流程**

   ![](https://github.com/2511366062/drawioPIC_lxk/blob/main/408os/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.png?raw=true)